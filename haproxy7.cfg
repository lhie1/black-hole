resolvers dns
    nameserver dns1 116.62.218.19:53
    nameserver dns2 139.196.72.143:53
    nameserver dns3 223.5.5.5:53
    nameserver dns4 223.6.6.6:53
global
    maxconn 10240
defaults
    log     global
    mode    tcp
    option  dontlognull
    option  redispatch
    option  abortonclose
    option  httpchk GET /
    timeout connect 5000
    timeout client  50000
    timeout server  50000
frontend ss-in1
    bind    *:152
    bind    *:153
    bind    *:156
    bind    *:30000-40000

    acl youtube req.ssl_sni -m end .youtube.com
	use_backend ss-out2 if youtube

	acl jp req.ssl_sni -m end .happyon.jp
    use_backend ss-out3 if jp

    default_backend ss-out1
backend ss-out1
    balance source
    server server1 cname1 check port 170 inter 2000
    server server2 cname2 check port 170 inter 2000
    server server3 cname3 check port 170 inter 2000
    server server4 cname4 check port 170 inter 2000
    server server5 cname5 check port 170 inter 2000
    server server6 cname6 check port 170 inter 10000
    server server7 cname7 check port 170 inter 10000
backend ss-out2
    balance source
    server server1 cname1 check port 170 inter 2000
    server server2 cname2 check port 170 inter 2000
    server server3 cname3 check port 170 inter 2000
    server server4 cname4 check port 170 inter 2000
    server server5 cname5 check port 170 inter 2000
backend ss-out3
    balance source
    server server6 cname6 check port 170 inter 10000
    server server7 cname7 check port 170 inter 10000
listen admin_stats
    stats   enable
    bind    *:8080
    mode    http
    option  httplog
    maxconn 10
    stats   refresh 30s
    stats   uri /admin?stats
    stats   realm haproxy
    stats   auth admin:admin
    stats   hide-version
    stats   admin if TRUE